// See LICENSE for license details.

//**************************************************************************
// MMIO read and write test
//--------------------------------------------------------------------------
//
//
#define SCRATCHPAD_BASE 0x8000000
#define ADDR1 0x0
#define ADDR2 0x8
#define FAILING_ADDR 0xf98

#include "mmio.h"
#include <stdio.h>

//--------------------------------------------------------------------------
// Main

// uint64_t nums[512] = {
//   0x5BD437D11C060EB0,
//   0xCCF82E81A4E75301,
//   0x861443788F5BF5F3,
//   0x05CF1F0DADFECC48,
//   0x3CA8A5DED351C0E9,
//   0x58F4C3D24B7F0A60,
//   0x036254DA137D02F2,
//   0x758361BEE7578798,
//   0x1771B218C31EE149,
//   0x02DEB3E7C46B7961,
//   0x122D9030342F106E,
//   0x4D179070EB2BE723,
//   0xBD17ADAE7CEAB694,
//   0x358D33998ED78D73,
//   0x4357F956178652C3,
//   0xFE9EBFD5DF2BA8F5,
//   0xF12BCB271DB4D182,
//   0x0127B05A3843F09C,
//   0xFF5FC5D5E8696154,
//   0x86351B33A4FCE229,
//   0xFF736E846916016F,
//   0xBBBFFDF3E91E64D5,
//   0xDAC2922F0CAF107D,
//   0xB646F731E2FB31BE,
//   0x315B9D274362E675,
//   0x5C29B7A19571BA15,
//   0xA03C0FC39DC751D0,
//   0x9A7AA4AA54C81472,
//   0x36CB1AE4D6A21202,
//   0x44FCEC29C65B5B0D,
//   0xB83E1A87F909B023,
//   0x205E3F2575954980,
//   0x0D257D96055D876C,
//   0xD4278C048FB9A7F5,
//   0x7FE39BB388E7D714,
//   0xF9491315E31B9622,
//   0xAA18C9B1F67B4F12,
//   0xCF8E70594133FD50,
//   0x773F89F3A5A1CB40,
//   0xB9FD0B385EB9104D,
//   0xB90D37A4C71AE845,
//   0x3D0A639935F5125E,
//   0x7BACC2EAC63CA3EC,
//   0xC0FFEE007E5D8D9B,
//   0xBB98CC014B948CB1,
//   0x9EBE49539CB2D50A,
//   0x488CBE3AF61D77BD,
//   0x8B8C0BA43A8EEE6B,
//   0x133DF3902927A190,
//   0x320E80077CAD970D,
//   0x9333387BCC75ED18,
//   0xC3A12B3EE7CC2884,
//   0xAE011409FD273177,
//   0x849CD23725A9F494,
//   0xDFC784312F8732E9,
//   0x14058F842CC45DFB,
//   0x106C3CCB1BFB51B0,
//   0xC2A1126A68A3A49D,
//   0x9CFC0337D562A737,
//   0x1C91FA8BAECF45BA,
//   0x5577FCD5DCDEFA28,
//   0x7A2A4E1E67635E8F,
//   0x297F1DAD12D08C44,
//   0x971678EC87613F22,
//   0x8744840DBE92C008,
//   0xFFA450D589D8E14A,
//   0xB67D74F84A4AE468,
//   0x206F51D75197809B,
//   0xFE239001E0DDC427,
//   0x550081B54ABA60D9,
//   0x501F13C0D02AE6FD,
//   0x8F3EA639739F8844,
//   0xB5759B8E62771D01,
//   0x44A35E0F2AF76B6C,
//   0x2073BDC15251E4D7,
//   0xD1E32F415A3BC9E0,
//   0x1BB724000BF5F843,
//   0xE3298AD15F65D7D5,
//   0x7D4956CBB2CD8047,
//   0xEAB266A8CC6BC82C,
//   0x96EB82C9FC0FAD12,
//   0x406BD1F0D2816137,
//   0x98FA2CD6C4BD869A,
//   0x1FAC53605CB1C5B5,
//   0xF78145207B4121F3,
//   0x92827331FE99BAD5,
//   0x2AB608DECE3718B8,
//   0x6AB0BE44FA8E9D4E,
//   0xCAAC5758F5B414B9,
//   0x4E0266CC4B2D03F1,
//   0xA41E88B5F079C844,
//   0x03D7AB10D6DAF1F6,
//   0x1A1C46E0E9398A04,
//   0x04A7695D83F8C7EE,
//   0xE912D800DA9A8D53,
//   0xB5426C7045CEC333,
//   0x27A380CDD7A9D236,
//   0xC90E41882375A5C1,
//   0xF4ECAFD5163BFD17,
//   0x30D57E33249E491F,
//   0x028B5D6450C55836,
//   0xCC287EC6150F7FC4,
//   0xB55A8C4C1833FBEE,
//   0x65D8CE591DA77111,
//   0xC4A64FA6A9CFB1C2,
//   0xAC6938A67F803047,
//   0x94E9676B10588F34,
//   0xCDE9DDD4EF5BF7CE,
//   0xF3B276020CC64562,
//   0x0582BBD437F6BB02,
//   0x973E647504EAC8F1,
//   0xA8D5379086052E9E,
//   0x1E88AB62E0BC13B3,
//   0xE36834048C738AA8,
//   0x8FC4DBDA537D8AD1,
//   0x44A2D0C211473704,
//   0xA87ED2095DEADB32,
//   0x4C34234A1C9A510F,
//   0xE3F59ABCCCFD31E6,
//   0xBDC88838FD277DA1,
//   0xD6482E9DF816FB38,
//   0x34D7786023686891,
//   0x52A0901AABEE708F,
//   0x0FBD6AD222BE4A6C,
//   0x992F9EE8387B5EFA,
//   0x21A9A9E2AA11F67E,
//   0xE83BD5514C1B7809,
//   0x3D22ACC56DC1114C,
//   0x18693F40DE631C0C,
//   0xB69A443E01CB2279,
//   0x3F548593A1F3B5B7,
//   0xD26881512A5955DD,
//   0x6DE9611D5D005170,
//   0xF6FCA9D4A2283C35,
//   0x88BF51AA30F3B9DF,
//   0xB215108FB9428E7B,
//   0xCB8ED8AB39BDF081,
//   0x242163B9DCF3CC14,
//   0xCF0C92E7A4C89271,
//   0x2DEAECC908698F26,
//   0x35FC109264B27309,
//   0xB7643FB23EF832A9,
//   0xA52CED9FBAD57CD5,
//   0xEB571F31FC20E025,
//   0x9846236737E51E60,
//   0x9F4ED791B9951783,
//   0x27F1CC44FEB47B6C,
//   0x910EF49A8F1EC57E,
//   0x6EE8FABD01CA82AE,
//   0xDE33B8F753B32561,
//   0x447B2D8B35F87649,
//   0x53465A08CD28DD45,
//   0x75D1418B3AB0F746,
//   0xF1A7A8302B88E2A3,
//   0xA4300F5B6AE03D1A,
//   0x8B13A4D17881F2E4,
//   0x082FFB2E66D85BFD,
//   0x10539386439C3A8E,
//   0x8D651ACACE04E582,
//   0x91F0C592641DCB6F,
//   0xD7BC9ED7A5C29304,
//   0x3391AE432B10B790,
//   0xAA2BC2D02A9AFD77,
//   0x5642E14550D92B5B,
//   0xDA8F133D2521E33E,
//   0xE3973903D9801652,
//   0xB1AF8F99CFD73216,
//   0x2351163234E433DA,
//   0x15E1E21E3D340C82,
//   0x3E8B11F6B2A29EE0,
//   0x5F48808DFB3FF713,
//   0x15E077614724A049,
//   0xA3237CECE8508547,
//   0xF4B81FD953F59205,
//   0x9D9D23D53E48919B,
//   0xDCBB0E87477974D9,
//   0x19403BD8EA73AB60,
//   0x04C5CB74FB427763,
//   0xF022BEED3E5E616C,
//   0xE18B9D37A43359AC,
//   0xFE3090CF6C889066,
//   0x5E6A15FAF54C41B4,
//   0x37157630EF0793AF,
//   0xA48DCC9CE924542A,
//   0xA42F93AC449464D0,
//   0x550273005C6D00D9,
//   0x4927B6D6991A2D44,
//   0x509D577C4CA829E1,
//   0xCD7879777A11E512,
//   0xB79CE3C5A5A016A3,
//   0xD213B1C95F074F2C,
//   0x258DC9188A6079E1,
//   0xBFB5AF91EC15D2CB,
//   0xEF4BD546B3675F8D,
//   0x50B8970ACBA9CC42,
//   0x8CA122D908229D7F,
//   0xA8D178ED875DD9C2,
//   0x6561D64F64F3474F,
//   0x2293A3B66884A709,
//   0x27300293CADAF5D2,
//   0xAA76AED2944D33EC,
//   0x8725598633A63485,
//   0xACCA4250DD3DB038,
//   0xC7FBA1815EB7F2EB,
//   0xE38DBECC132414EB,
//   0x10F8733BE79E0C1F,
//   0xE588471D13677DB3,
//   0x8E9016FF88927E3E,
//   0x5ED976CDE16FA4A2,
//   0xB80431DD8CE6F2EE,
//   0xA84835B77BE24E30,
//   0x0D432C833D84FC6F,
//   0x03A4DAA3D5820011,
//   0x8859163CA21A7FC7,
//   0x17518D4B806B4EDD,
//   0x6C180DBD6177BF30,
//   0x7256646C60FD2BB6,
//   0xA5AA85995E5CA274,
//   0xAB2A57506E960272,
//   0xB6769E7E2C76B8A4,
//   0x311A36A91D0D8513,
//   0x3D5D4F21DE69F796,
//   0x8BCC11ACC362DCED,
//   0x0DCA45F8C0C67D0E,
//   0x92DCAD86FCBEADD3,
//   0xC552B4ED924387AB,
//   0x2ED30876FECAC518,
//   0x4431808D55679F32,
//   0x97EAC640D5FDB84D,
//   0x6D9EB2EDD5C2182C,
//   0xA84C5A24A11D6F3B,
//   0xBB3A6E522DDFD68F,
//   0x39C1DABF9CA92403,
//   0x64078A5329B821DC,
//   0xFC07EFA67DEFDCDF,
//   0x8427AE18459517EF,
//   0x2C2A5F360F82DA6A,
//   0x9459FB23B3B1C48B,
//   0xCE23132CF0D145AA,
//   0x7D085CE371CC1C99,
//   0x9A64B8D2AE2574B2,
//   0x54BFB67057FC9191,
//   0x67189CC2110D08F5,
//   0xBD343BBEE76BE392,
//   0xD20F116752C5A33A,
//   0x8E329B34A8605E70,
//   0x7AB8D5E926855160,
//   0x6166665AFB87B097,
//   0x35E592F5E5C2A5E8,
//   0xD09255D1995DF0A5,
//   0x7226ED5D59B81E0B,
//   0xDDF783DBCA0568A0,
//   0x812B89141D8EF177,
//   0xD2B9B9144A6F50CD,
//   0x29B0868F8BFBC551,
//   0x8DEAA1AF3ED06333,
//   0x0B925BF49AA06CFF,
//   0x286891CDD5FE81AF,
//   0x365BA6906607F895,
//   0xA4865AFFECE5C0E5,
//   0xA39096CB7510E7E9,
//   0x3D889A689AA42EB3,
//   0x62D9BEFECB0642CF,
//   0xA850F01B0A39F7E6,
//   0x998716C1554AC057,
//   0x3DF225DD2B1EB66C,
//   0xABCC2677C412D561,
//   0x41A10744CCD29658,
//   0x2F8EFE5E84A9729B,
//   0x9671177DB435C7E6,
//   0xAD47F21C17CE4763,
//   0x3E3C784BF5159E7E,
//   0x5AD97265180D24EA,
//   0x35464C6C2E9000A1,
//   0x2C00CEC4801E62FB,
//   0x6C23795666DABE63,
//   0xEF9D3F5848974912,
//   0xAA3AEE22B4049E9B,
//   0x1F3D862EE1AD793D,
//   0x1BCC0A2CD1F5FE34,
//   0x6676902DB40B3D47,
//   0x0E5DF9B758BEF657,
//   0x85A58DEA47118BF3,
//   0x16A7147B7D50AC55,
//   0x1864AC8F53A1B52B,
//   0x89F93F85A4A6BF05,
//   0x792E4946FCD2C04E,
//   0xE305DC7F520AFAE2,
//   0xB5CED96EC9782325,
//   0xAEB696814231D535,
//   0x103681704FFA05D3,
//   0x87220801F30E01DC,
//   0xBE570262949D186F,
//   0x9A96D1BE7251F4B6,
//   0xEFE79EF30FE9E7E2,
//   0xD4C2A601321957C1,
//   0x88D11FAC57578AC2,
//   0xBC9C9FBBC2CE974C,
//   0x552C600133C27B67,
//   0x527EBE1E5C4AF232,
//   0xC81A3ACAD781BD5F,
//   0x246E499BD6D9CCA9,
//   0xB00E515859BCFAF3,
//   0x9965EF7EBB766506,
//   0xDB431C26B2D7FF20,
//   0x1597D2870D8ADB90,
//   0x4B21B51FF3568AEE,
//   0x94005C56CCD9C541,
//   0x83585A660437B5A4,
//   0xEC741590CD0B5EDA,
//   0xEBB8581E036902B4,
//   0x28BE2AD63DA101F5,
//   0x173773B58AEF0572,
//   0xD541E1FD252B410A,
//   0xCAB4149AA9498223,
//   0x7FB04FC51805ECF1,
//   0xBEEF4B6225810878,
//   0x8A8398D42D4F7D52,
//   0x791910919E7B5E79,
//   0x6CBEBE4BEAD6C65F,
//   0x9EFE36110C29D797,
//   0x11E36F7306CCEC09,
//   0xED7E8975438BB704,
//   0xD3D38C2201A56626,
//   0xC4A3F18C6C0BDD12,
//   0x2B915C8482FBAC90,
//   0xAD70DE421AD568FE,
//   0x86E83DCAB8F246AF,
//   0x594ABA3062F2C79C,
//   0xF892F18A5FE828C1,
//   0xAC55BEFD010B853A,
//   0x054088DBBDC7335D,
//   0x1A1FBEF747984599,
//   0x709F425C591C092A,
//   0xDC9633A9ED298363,
//   0x45D55A1F8C6BF375,
//   0x8AD305266BDD9D50,
//   0x1172F0F97A9E80B8,
//   0x38B828FC0E6C3D05,
//   0x90FC7089A05D34FD,
//   0x2EB4304BF5EC35DB,
//   0x60436A524838B884,
//   0xA631B7E26DDA17C1,
//   0x71CFB4D2FAE21562,
//   0x91E8CA06553E1A9E,
//   0x74738DE3BE9AD2FC,
//   0x09A6C7A9DBC810D8,
//   0x9B737D3ED56F9423,
//   0x252C690669F103C9,
//   0x426A30047B9309E1,
//   0xE08D0B75531087E6,
//   0x081182D2FBFE03A9,
//   0x65FB2B8C96590548,
//   0xFCDCC4B4D9EC823E,
//   0x8664B8B8B398FCED,
//   0x027783480FB0B725,
//   0xF5CB97A93A85E316,
//   0x4402DA5FB5C433FC,
//   0x4D30F2093B7F5977,
//   0x7B0712E5E9AFE7B0,
//   0xFF25A9657FDC8F96,
//   0x7F4C98406AF203FD,
//   0xD7EE96729104ED1F,
//   0x187351AFC835AB93,
//   0xFC9EE679E593C27D,
//   0x9B58D90FA08DA10D,
//   0x866D78288D5023EA,
//   0x5140DC91B62FB17A,
//   0x2B9961329927578B,
//   0xEDE001D8865DD7EA,
//   0xB38CDA3E21739601,
//   0x131033D6B4ECD4B2,
//   0xF59110D35BFDFC74,
//   0x0FF95462A1A983B7,
//   0x29F564D3DADB7FE0,
//   0xBECC416B8789F23C,
//   0x137F0860C76EB07D,
//   0xE5A3AB90D40A40DA,
//   0x679F87FA16653503,
//   0x7A4A00FFAEF909B0,
//   0x87DD552992C06AF9,
//   0xA0690F10312C4C5D,
//   0x5E323FF6FC601886,
//   0x4048B54C14A4DDFA,
//   0x6D45898BCC2EF0A6,
//   0xF745D7D9EBAE837C,
//   0xC7E1598315FA3B4A,
//   0x60345F6711BE71C7,
//   0xB7CEBE69F37A712C,
//   0x6D717E582C5441CF,
//   0xFBC63D70E507DD72,
//   0xA68150F73267327E,
//   0x1CC82270E2B41635,
//   0xEB58BC098231B426,
//   0x73FA118A1C266684,
//   0xB97C967005F3D1D9,
//   0x96F7FD8C3D4F2FB0,
//   0xD8256F10BB5A508C,
//   0x2D6895C0BA746CBB,
//   0x703F829F552EB78D,
//   0xD7D01F893B0437F5,
//   0xCCAF19B4F79DB2FF,
//   0x1D7B658EE68A24AF,
//   0x7A0EC00B4DDE22E9,
//   0x6459C6C8BEEE667C,
//   0xB6C0C50B6F794E64,
//   0x67915DAF9E6F6A4E,
//   0x7BA7A95698306CCE,
//   0xDC84FFE85F8D1F3B,
//   0xE843884214B5FF39,
//   0x06158A6638FE4350,
//   0xE17C1D42D138E918,
//   0xA0A1A4C23982A449,
//   0xBE52215A1A41FBF7,
//   0xCA9E6C8491C4EDF9,
//   0xE9DD577335EB4FAD,
//   0xC142F0D1A339BE5B,
//   0x8B91FC602E6C2662,
//   0xBE991558D93389D2,
//   0xBAF98F6C95B7F911,
//   0x6B707F5DF8138524,
//   0xB898AEAA895E2B5B,
//   0x6956958210B4E789,
//   0xCA0840229835CF12,
//   0xA890482AB3EE286B,
//   0x363AE4C06BE2DCA7,
//   0x581DB2AD6328EF2E,
//   0xC906EC14E6472000,
//   0xBB571238D07C6BA3,
//   0xF54C7C2E206CA498,
//   0x27E333C41A258330,
//   0xA842896099984A7E,
//   0x382AF205DCF980E7,
//   0xD549D1F5D7585F58,
//   0x1C63DB031965AC67,
//   0x411726D16D3AA99B,
//   0x5AEBA20885BC929D,
//   0x30CD1E644688CCF9,
//   0x24140D35045943DD,
//   0x24C442F90C8945C4,
//   0x27C7D0A7930A19F1,
//   0x18C94737B50B61FE,
//   0x981913115A8BEE63,
//   0xFF9795850A71125E,
//   0x39B615DEA37DEC8D,
//   0x81B6236A2446F26F,
//   0x9A45412973F15C0E,
//   0xB6BC5371984033A7,
//   0x4EA87651147CB1FE,
//   0xB654521AE46C1E20,
//   0x4C8506A084741F1D,
//   0x63BE3A23C3C42E04,
//   0xFEE18D50496D633F,
//   0x9B014A19571E7084,
//   0x020BACDE8BB09B29,
//   0x289B1E5472518524,
//   0x565BDB3FA9403E4C,
//   0x23543524850F340A,
//   0x37898FA4B31C4C67,
//   0x96B077E8F268D049,
//   0x4317683B10B3D0AF,
//   0x24DD9590589CF6B8,
//   0x0364411B8CBED868,
//   0xAE0ABCD5F4772EAF,
//   0x3D107672801AA0EF,
//   0x895979D9C2E99B49,
//   0xE0AF4B0CCB29F39A,
//   0x0FBCC2014577D9DD,
//   0xEF6CA266BCD823C5,
//   0xB4785E216E82373C,
//   0x9DF2C8C59F1F5515,
//   0x7E31081EFFBBFDC6,
//   0xE7973ADD77573045,
//   0xC80D8DCA3C86DB96,
//   0x8A12087A4051B35C,
//   0xA87CDEB3FE6F026B,
//   0xE8B9BF297CC39EBF,
//   0x1707F3A02CD670BC,
//   0x7E95913AE90A9B2C,
//   0x2FA35B71FD1CA324,
//   0xA8DEFFE2507B32D7,
//   0x4937F261BF1DA865,
//   0xA04033E4FF486A69,
//   0x5AB276D1AA140D69,
//   0x910222B5F284696E,
//   0xEA7C6A19FF210461,
//   0x285C728992BC7288,
//   0x447FEDB761994E27,
//   0xCFDE883075F0D85F,
//   0x0BB7A8F6CA1A5D75,
//   0xF0240CC835EF59F6,
//   0x319DFD168B4CC288,
//   0x862C243679FDA703,
//   0x983770BAF360EECC,
//   0x97FC6A1840F75110,
//   0xB9176E619C72BF09,
//   0x97EA0648AC7902BE,
//   0xD9FE659A7E5999E8,
//   0x270F68B8931B6193,
//   0x45B5B7121DD0ED58,
//   0x0F93EC205BC8A694,
//   0xABD50778D11FC9F5,
//   0x79F5D01209E1F74D,
//   0x364E6CC7DF445B61,
//   0x34DE0A33EC31E5B3,
//   0x896ADB96363C73DB,
//   0x2DDFADA690B509FD,
//   0xAB304742D5246F2E,
//   0xC6DBA7A3C439541F,
//   0x5AB0F5925234FBA0,
//   0x081993A716CF99C2,
//   0x46A8107AE5E2100E
// };

int main( int argc, char* argv[] )
{
  uint64_t result;

  reg_write64(SCRATCHPAD_BASE + ADDR1, 0xAAAAAAAAAAAAAAAAL);
  reg_write64(SCRATCHPAD_BASE + ADDR2, 0xBBBBBBBBBBBBBBBBL);
  reg_write64(SCRATCHPAD_BASE + FAILING_ADDR, 0xCCCCCCCCCCCCCCCCL);
  result = reg_read64(SCRATCHPAD_BASE + FAILING_ADDR);
  printf("Read 0x%016lx from address 0x%lx\n", result, SCRATCHPAD_BASE + FAILING_ADDR);
  result = reg_read64(SCRATCHPAD_BASE + ADDR1);
  printf("Read 0x%016lx from address 0x%lx\n", result, SCRATCHPAD_BASE + ADDR1);
  result = reg_read32(SCRATCHPAD_BASE + ADDR2);
  printf("Read 0x%08lx from address 0x%lx\n", result, SCRATCHPAD_BASE + ADDR2);
  result = reg_read64(SCRATCHPAD_BASE + FAILING_ADDR);
  printf("Read 0x%016lx from address 0x%lx\n", result, SCRATCHPAD_BASE + FAILING_ADDR);
  // for (int i = 0; i < 512; i++) {
  //   reg_write64(SCRATCHPAD_BASE + 8 * i, nums[i]);
  // }
  // printf("Finished writing all addresses.\n");
  // for (int i = 0; i < 512; i++) {
  //   result = reg_read64(SCRATCHPAD_BASE + 8*i);
  //   if (result != nums[i]) {
  //     printf("ERROR: Read 0x%016x at addr 0x%x, expected 0x%016x\n", result, SCRATCHPAD_BASE + 8*i, nums[i]);
  //   }
  // }
  // printf("Finished reading all addresses.\n");

  return 0;
}
