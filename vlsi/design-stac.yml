# Generate Make include to aid in flow
vlsi.core.build_system: make

technology.sky130.drc_blackbox_srams: true

# SRAMs for BIST module (since these aren't seen by macrocompiler)
# NOTE: this doesn't work so we add it directly to Makefile
# vlsi.inputs.sram_parameters: "stac-srams.json"
# vlsi.inputs.sram_parameters_meta: ["transclude", "json2list", "prependlocal"]

# TDC
vlsi.technology.extra_libraries_meta: ["append", "deepsubst"]
vlsi.technology.extra_libraries:
  - library:
      lef_file: /tools/C/rahulkumar/personal/tdc_sky130_macros/tdc_64/tdc_64.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/tdc_sky130_macros/tdc_64/tdc_64.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/delay_line_sky130_macros/tristate_inv_delay_line_128/tristate_inv_delay_line_128.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/delay_line_sky130_macros/tristate_inv_delay_line_128/tristate_inv_delay_line_128.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_2048x32m8w8_test/sram22_2048x32m8w8_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_2048x32m8w8_test/sram22_2048x32m8w8_test.schematic.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_1024x32m8w8_test/sram22_1024x32m8w8_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_1024x32m8w8_test/sram22_1024x32m8w8_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_1024x32m8w32_test/sram22_1024x32m8w32_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_1024x32m8w32_test/sram22_1024x32m8w32_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_512x32m4w32_test/sram22_512x32m4w32_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_512x32m4w32_test/sram22_512x32m4w32_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_512x32m4w8_test/sram22_512x32m4w8_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_512x32m4w8_test/sram22_512x32m4w8_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_256x32m4w8_test/sram22_256x32m4w8_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_256x32m4w8_test/sram22_256x32m4w8_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x32m4w8_test/sram22_64x32m4w8_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x32m4w8_test/sram22_64x32m4w8_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x24m4w24_test/sram22_64x24m4w24_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x24m4w24_test/sram22_64x24m4w24_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]
  - library:
      lef_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x4m4w2_test/sram22_64x4m4w2_test.lef
      nldm_liberty_file: /tools/C/rahulkumar/personal/stac-top/vlsi/sram22_sky130_macros/sram22_64x4m4w2_test/sram22_64x4m4w2_test_tt_025C_1v80.rc.lib
      corner: {nmos: typical, pmos: typical, temperature: "025 C"}
      supplies: {VDD: "1.80 V", GND: "0 V"}
      provides: [ {lib_type: stdcell, vt: RVT} ]

vlsi.inputs:
  power_spec_type: cpf
  power_spec_mode: auto
  supplies:
    power:
      - {name: "VDD", pin: "VDD"}
    ground:
      - {name: "VSS", pin: "VSS"}
    VDD: "1.8 V"
    GND: "0 V"

  top_module: ChipTop

  clocks:
    - {name: "clock_clock", period: "20ns", uncertainty: "1ns"} # temporary

  pin_mode: none

  placement_constraints:
    - path: ChipTop
      type: toplevel
      x: 0
      y: 0
      width: 3588
      height: 5188
      margins: {left: 20, bottom: 20,
                right: 0, # must be 0 so that power pins (to power straps) are created
                top: 3500} # block off as much as possible for test SRAMs/analog

    # Place SRAM memory instances

    # TODO: improve sram placements

    # backing scratchpad
    - {path: ChipTop/system/subsystem_mbus/spad/backingscratchpad/backingscratchpad_ext/mem_0_0, type: hardmacro, 
      x: 3000, y: 20, orientation: my90}
    
    # dcache
    - {path: ChipTop/system/tile_prci_domain/tile_reset_domain_tile/dcache/data/data_arrays_0/backingscratchpad_ext/mem_0_0, type: hardmacro, 
      x: 20, y: 20, orientation: my90}
    - {path: ChipTop/system/tile_prci_domain/tile_reset_domain_tile/dcache/tag_array_0/tag_array_0_ext/mem_0_0, type: hardmacro, 
      x: 600, y: 20, orientation: r270}

    # TODO: place icache now that the sram exists again
    # icache
    - {path: ChipTop/system/tile_prci_domain/tile_reset_domain_tile/frontend/icache/data_arrays_0_0/data_arrays_0_0_ext/mem_0_0, type: hardmacro, 
      x: 2643, y: 20, orientation: r270}
    - {path: ChipTop/system/tile_prci_domain/tile_reset_domain_tile/frontend/icache/data_arrays_1_0/data_arrays_0_0_ext/mem_0_0, type: hardmacro, 
      x: 2630, y: 750, orientation: r270}
    - {path: ChipTop/system/tile_prci_domain/tile_reset_domain_tile/frontend/icache/tag_array_0/tag_array_0_0_ext/mem_0_0, type: hardmacro, 
      x: 809, y: 20, orientation: my90}
    
    # test srams
    - {path: ChipTop/system/sramBistClockDomainWrapper/sram_bist_0/sramBist/bistTop/srams_0/inner, type: hardmacro, 
      x: 20, y: 570, orientation: my90}
    - {path: ChipTop/system/sramBistClockDomainWrapper/sram_bist_0/sramBist/bistTop/srams_1/inner, type: hardmacro, 
      x: 20, y: 900, orientation: my90}

    # TODO: place TDC?
    - {path: ChipTop/system/sramBistClockDomainWrapper/sram_bist_0/sramBist/bistTop/harnesses_0/tdc, type: hardmacro, 
      x: 500, y: 570, orientation: mx}
    - {path: ChipTop/system/sramBistClockDomainWrapper/sram_bist_0/sramBist/bistTop/harnesses_1/tdc, type: hardmacro, 
      x: 500, y: 900, orientation: mx}
    
 
# Power Straps
par.power_straps_mode: generate
par.generate_power_straps_method: by_tracks
par.blockage_spacing: 2.0
par.blockage_spacing_top_layer: met3
par.generate_power_straps_options:
  by_tracks:
    strap_layers:
      - met4
      - met5
    pin_layers:
      - met5
    blockage_spacing_met2: 4.0
    blockage_spacing_met4: 2.0
    track_width: 3
    track_width_met5: 1
    track_spacing: 5
    track_start: 10
    track_start_met5: 1
    power_utilization: 0.1
    power_utilization_met4: 0.1
    power_utilization_met5: 0.1

# Pin placement constraints
vlsi.inputs.pin_mode: generated
vlsi.inputs.pin.generate_mode: semi_auto
vlsi.inputs.pin.assignments: [
  {pins: "*", layers: ["met2", "met4"], side: "bottom"}
]
